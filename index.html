<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teszt</title>
</head>

<body>
  <p>
    Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolor saepe impedit cum ipsum mollitia. Fugit voluptatem
    dolorum hic id nam quod. Nemo corporis quibusdam distinctio delectus amet ipsum corrupti neque?
    Lorem ipsum dolor sit amet consectetur adipisicing elit. Nobis, officiis neque repellat non expedita nostrum sint
    est repellendus molestiae commodi corrupti enim soluta itaque voluptates iusto, vitae ducimus molestias velit.
    Lorem ipsum dolor sit amet consectetur, adipisicing elit. Commodi similique aperiam sunt eos exercitationem nulla,
    inventore aut quos necessitatibus sed beatae voluptate vel officia quod aspernatur, consectetur facilis, porro
    nesciunt.
  </p>

  <div id="boards"></div>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="js/draughts.js"></script>
  <script src="js/draughtsboard.js"></script>
  <link rel="stylesheet" href="css/draughtsboard.css">
  <script>
    //A positions tömb tartalmazza az összes állást.

    //A "fen" tartalmazza a kezdő állást,
    //A "solution" tartalmazza a megoldást,
    //A "comment" tartalmazza azt a szövegrészt, ami az adott tábla előtti magyarázat
    const positions = [
      {
        "id": "1",
        "fen": "W:W31,32:B1,2",
        "solution": ["32-28", "2-8", "28-22", "8-12", "31-26", "1-6", "22-17", "12x21", "26x17"],
        "comment": "Ez egy egyszerű példa, ahol a fehér bábu 31-ről 28-ra lép, majd a fekete bábu 2-ről 8-ra lép, és így tovább. A megoldás lépései sorban követik egymást."
      },
      {
        "id": "2",
        "fen": "W:W12:B8,11",
        "solution": ["12x3", "11-16", ["3-8", "3-12", "3-17", "3-26"]],
        "comment": "Ez egy másik példa, ahol a fehér bábu 12-ről 3-ra lép, majd a fekete bábu 11-ről 16-ra lép, és végül a fehér dáma 3-ról akárhova léphet, csak 21-re nem. A megoldás lépései szintén sorban követik egymást."
      }
    ];

    positions.forEach((pos, idx) => {
      //Szöveg beszúrása
      if (pos.comment) {
        const commentDiv = document.createElement('div');
        commentDiv.innerHTML = pos.comment;
        commentDiv.style.margin = '0 0 20px 0';
        document.getElementById('boards').appendChild(commentDiv);
      }


      // 1. Tábla div létrehozása
      const boardDiv = document.createElement('div');
      boardDiv.id = 'board' + idx;
      boardDiv.style.width = '500px';
      boardDiv.style.marginBottom = '30px';
      document.getElementById('boards').appendChild(boardDiv);

      // 2. Draughts példány és megoldás
      const game = new Draughts(pos.fen);
      let moveCount = 0;

      // 3. Eseménykezelők
      function onDragStart(source, piece, position, orientation) {
        if (game.gameOver()) return false;
        var turn = game.turn();
        if ((turn === 'w' && (piece[0] !== 'w' && piece[0] !== 'W')) ||
          (turn === 'b' && (piece[0] !== 'b' && piece[0] !== 'B')))
          return false;
      }
      function onDrop(source, target) {
        var legal = game.moves();
        let currentSolution = pos.solution[moveCount];
        let goodMoves = Array.isArray(currentSolution) ? currentSolution : [currentSolution];
        // A megadott több jó megoldások közül nézi meg, hogy a lépés jó-e
        let isGood = goodMoves.some(sol => {
          let [from, to] = sol.split(/[-x]/);
          return source == from && target == to;
        });
        // Keresd meg a lehetséges lépések között a megfelelőt!
        var found = legal.find(m => m.from == source && m.to == target);
        if (!found || !isGood) {
          return 'snapback';
        }
        var move = game.move(found);
        if (move === null) {
          return 'snapback';
        } else {
          moveCount += 1;
          // Automatikus válasz, ha van még lépés
          if (moveCount < pos.solution.length) {
            let nextSol = pos.solution[moveCount];
            let nextMoves = Array.isArray(nextSol) ? nextSol : [nextSol];
            let next = nextMoves[0].split(/[-x]/);
            let blackMove = game.moves().find(m => m.from == next[0] && m.to == next[1]);
            if (blackMove) {
              game.move(blackMove);
              moveCount += 1;
            }
          }
        }
      }
      function onSnapEnd() {
        boards[idx].position(game.fen());
      }

      // 4. DraughtsBoard példány
      const config = {
        draggable: true,
        position: pos.fen,
        onDragStart: onDragStart,
        onDrop: onDrop,
        onSnapEnd: onSnapEnd,
        pieceTheme: 'unicode'
      };
      // Tároljuk a boardokat, ha kell később
      window.boards = window.boards || [];
      window.boards[idx] = DraughtsBoard(boardDiv.id, config);
    });
  </script>


  <p>
    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Iure harum sunt adipisci, dolorum, voluptate nostrum
    repellendus quia iste deleniti, accusamus consequuntur illo? Esse neque alias ex laudantium quos fugit saepe?
    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Perspiciatis repellat ad id, aspernatur unde consequatur
    veritatis ea adipisci rerum minima atque tempora recusandae. Harum autem molestias, quis dicta maiores error?
    Lorem ipsum dolor sit, amet consectetur adipisicing elit. Suscipit excepturi facere iusto dolorem fugit debitis,
    error accusamus eos aliquid qui id. Velit fuga accusamus laboriosam in quisquam aut nam sapiente!
  </p>
</body>

</html>